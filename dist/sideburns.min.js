/*! bp-sideburns 2015-06-29 */
!function(){"use strict";var a={ignoreUndefined:!1,escape:"general",escapeSets:{xml:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},general:{'"':'\\"',"'":"\\'"}}},b=function(a,c){var d;for(d in c)c.hasOwnProperty(d)&&("object"==typeof a[d]&&"object"==typeof c[d]?a[d]=b(a[d],c[d]):a[d]=c[d]);return a},c=function(a,b,c,d){var e,f=function(a,b,c){var g;if(a.length>1){if(g=e.shift(),!c.hasOwnProperty(g)){if(!d)throw new Error("No internal property "+g+" at depth N - "+e.length);c[g]={}}f(a,b,c[g])}else c[a[0]]=b};return e=a.push||a.map?a:a.split(".").map(function(a){return a.trim()}),f(e,b,c),c},d=function(a,b){var c,d=null,e=function(b,f){var g;if(b.length>1){if(!f.hasOwnProperty(b[0]))throw g=b.reduce(function(a,b,c){return a+(c>0?".":"")+b}),new Error('Invalid proprty, missing expected data "'+g+'" (IDENT: '+a+") from data "+JSON.stringify(f));e(b,f[c.shift()])}else{if(!f.hasOwnProperty(b[0]))throw new Error('Invalid proprty, missing expected data "'+b[0]+'" (IDENT: '+a+") from data "+JSON.stringify(f));d=f[b[0]]}};return c=a.push||a.map?a:a.split(".").map(function(a){return a.trim()}),e(c,b),d},e=function(a,b){var c;try{c=d(a,b)}catch(e){c=void 0}return c},f=function(a,c){if("object"!=typeof a)throw new TypeError("Cannot deep merge with an "+typeof a+": [Param 1]");if("object"!=typeof c)throw new TypeError("Cannot deep merge with an "+typeof c+": [Param 2]");return b(b({},a),c)},g=function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a=String(a).split(c).join(b[c]));return a},h=/(\[\[)(\#|\/)?\s*(?:([a-zA-Z]+[a-zA-Z0-9]*)\s*\:\s*([a-zA-Z]+[a-zA-Z0-9]*)|([\*\&\>\?]?)\s*((?:\!(?:\(([a-zA-Z]+[a-zA-Z0-9]*)\))?)?)\s*([a-zA-Z](?:[a-zA-Z0-9]*(?:\.(?=[a-zA-Z]))?)+))\s*(\]\])/,i=function(a,b,c){return this.ident=a||"N_NULL",this.val=b||null,this.content=c||{},this},j=function(a,b,c){return this.ident=a||"T_NULL",this.val=b||null,this.info=c||{},this},k=function(a){var b,c,d,e=[],f=0,g=null;for(b=function(){return null!==(g=h.exec(c))};f<a.length;)if(c=a.substr(f),b()){if(g.index>0&&e.push(new j("STRING",g.input.substr(0,g.index))),d=new j("T_NULL",null,{close:!1,escape:!1,escapeType:null}),"#"===g[2])d.ident="T_DIRECTIVE",d.val={key:g[3],value:g[4]};else{switch("/"===g[2]&&(d.info.close=!0),g[5]){case"*":d.ident="T_LOOP";break;case"&":d.ident="T_BLOCK";break;case">":d.ident="T_IMPORT";break;case"?":d.ident="T_CONDITION";break;default:d.ident="T_DATA"}"undefined"!=typeof g[6]&&"!"===g[6].charAt(0)&&(d.info.escape=!0,"undefined"!=typeof g[7]&&(d.info.escapeType=g[7])),d.val=g[8]}e.push(d),f+=g.index+g[0].length}else e.push(new j("STRING",c)),f+=c.length;return e.push(new j("EOD")),e},l=function(a){for(var b,c,d,e,f,g=0;g<a.length;)if(a[g].info&&a[g].info.close){for(b=[],d=a[g],c=g-1;a[c].ident!==d.ident||a[c].val!==d.val;)if(b.push(a[c]),c-=1,0>c)throw new Error("Unmatched Closing Tag "+e+" at index "+g);switch(d.ident){case"T_LOOP":case"T_BLOCK":case"T_CONDITION":f="N"+d.ident.slice(1);break;default:throw new Error("Invalid block element "+d.ident+" at index "+g)}e=new i(f,d.val,b.slice().reverse()),a.splice(c,g-c+1,e),g=0}else g+=1;return a},m=function(a,f,h,i){var j,k,l,n,o,p,q,r,s;switch(f.ident){case"STRING":return a+f.val;case"T_DIRECTIVE":return c(f.val.key,f.val.value,i.opts,!0),a;case"T_DATA":return o=f.val,i.loopTag&&f.val===i.loopTag.slice(0,-1)&&(o=i.loopTag+"."+i.i.toString()),p=d(o,i.data),f.info.escape&&(q=f.info.escapeType?f.info.escapeType:i.opts.escape,p=g(p,i.opts.escapeSets[q])),a+p;case"T_IMPORT":if(l=i.includes[f.val],"undefined"!=typeof l&&null!==l)p=l(i.data,i.opts);else{if(!i.opts.ignoreUndefined)throw new Error("Cannot get include "+f.val);p=""}return a+p;case"N_LOOP":for(l="",j=f.content,j.data=i.data,j.loopTag=f.val,j.includes=i.includes,j.opts=b({},i.opts),k=d(f.val,i.data),n=0;n<k.length;n+=1)j.i=n,l+=j.reduce(m,"");return a+l;case"N_BLOCK":return j=f.content,j.data=d(f.val,i.data),j.loopTag=null,j.includes=i.includes,j.opts=b({},i.opts),a+j.reduce(m,"");case"N_CONDITION":return s=e(f.val,i.opts),s?(j=f.content,j.data=i.data,j.loopTag=null,j.includes=i.includes,j.opts=b({},i.opts),r=j.reduce(m,"")):r="",a+r;default:return a}},n=function(b,c,d){var e=l(k(b));return e.data=c,e.loopTag=null,e.i=null,e.includes=n.includes,e.opts=f(a,d),e.reduce(m,"")};n.partial=function(b){return function(b,c,d){return b.data=c,b.loopTag=null,b.i=null,b.includes=n.includes,b.opts=f(a,d),b.reduce(m,"")}.bind(null,l(k(b)))},n.includes={},n.addInclude=function(a,b){b.split?this.includes[a]=n.partial(b):this.includes[a]=b},"undefined"!=typeof module&&module.exports?module.exports=n:window.sideburns=n}();
